<!DOCTYPE html>

<html>
  <head>
    <meta charset="UTF-8">
    <title>Smart Triage - Hospital Moinhos do Vento</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css" />
    <link href="./style.css" rel="stylesheet">
  </head>


  <body>

    <main>

    
      <form id="formStep1" action="./step-two.html" method="post">

        <div class="row">
          <div class="col-sm-4"></div>
          <div class="col-sm-4 text-center">
            <h2 class="primary-text primary-title animate__animated animate__fadeInUp">Smart Triage</h2>
            <!-- <p class="primary-text primary-p animate__animated animate__fadeIn animate__delay-1s">Faça sua triagem antes de chegar a Moinhos do Vento mais próxima!</p>   -->
          </div>        
        </div>

        <div class="divider-md"></div>

        <div class="row">
          <div class="col-sm-4"></div>
          <div class="col-sm-4 text-center">
            <div class="progress animate__animated animate__fadeInUp">
              <div class="progress-bar progress-bar-striped progress-bar-animated" role="progressbar" style="width: 33%" aria-valuenow="33" aria-valuemin="0" aria-valuemax="100"></div>
            </div>
          </div>
        </div>

        <div class="divider-xl"></div>

        <div class="row">
          <div class="col-sm-4"></div>
          <div class="col-sm-4 text-center">
            <div class="mb-3 animate__animated animate__zoomIn">
              <!-- <label for="inputEmail1" class="form-label">Digite seu CPF</label> -->
              <input type="text" class="form-control form-control-lg" id="inputEmail1" aria-describedby="emailHelp" placeholder="Digite seu CPF" autofocus>
              <!-- <div id="emailHelp" class="form-text">We'll never share your email with anyone else.</div> -->
            </div>
          </div>
        </div>

        <div class="divider-xl"></div>

        <div class="row">
          <div class="col-xs-5 col-md-4 col-lg-4 col-xl-5"></div>
          <div class="col-xs-2 col-md-4 col-lg-4 col-xl-2 text-center animate__animated animate__fadeInUp">
            <button type="submit" class="btn btn-primary btn-lg" id="btn-cta">Iniciar Triagem</button>
          </div>
        </div>

        <div class="divider-sm"></div>

        <div class="row">
          <div class="col-sm-3"></div>
          <div class="col-sm-6 text-center">
            <p class="primary-text primary-p">Desenvolvido por Grupo 14 - Challenge FIAP<br/>© 2022</p>
          </div>
        </div>

      </form>

    </main>
    
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/js-cookie@3.0.1/dist/js.cookie.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>

    <script type="module">



      $("#formStep1").on("submit", function(){


        var $form = $(this);
        $.ajax({
            type: 'GET',
            crossDomain: true,
            // data: "cpf="+ $("#inputEmail1").val(),
            // dataType: 'json',
            url: "http://ec2-52-4-254-101.compute-1.amazonaws.com:8080/v1/hmv/questions/"+$("#inputEmail1").val(),
              // "headers": {
              //   "accept": "application/json",
              //   "Access-Control-Allow-Origin":"*",
                // "Access-Control-Allow-Headers": "*",
                //only need part of this for my custom header
                // "Access-Control-Allow-Headers": "x-requested-with, x-requested-by"
            // },
            success: function (data, textStatus, xhr) {

              // Cliente já havia preenchido a app anteriormente, os próximos passados trazem as questōes já preenchidas
              if (xhr.status == 200) {
                Cookies.set('cpf', $("#inputEmail1").val(), { expires: 7, path: './' });
                Cookies.set('answers', JSON.stringify(data), { expires: 7, path: './' });
                console.log("Consulta de cpf ok "+$("#inputEmail1").val());
                
                window.location.href = $form.attr("action");
              }
            },
            error: function (error) {

              // Cliente náo tinha acessado a app anteriormente, os próximos passos seguem normalmente como primeiro acesso!
              if (error.status == 404) {
                
                Cookies.set('cpf', $("#inputEmail1").val(), { expires: 7, path: './' });
                Cookies.set('answers', "", { expires: 7, path: './' });
                console.log("Cliente com primeiro acesso a app!");
                
                window.location.href = $form.attr("action");
              } else {
                console.log("Erro "+error.status);
              }
            }
        })

        return false;
      });

    </script>
  </body>
</html>